services:
  - type: web
    name: vibe-plotter-api
    runtime: python
    plan: starter
    buildCommand: |
      cd apps/api
      pip install -r requirements.txt
    startCommand: |
      cd apps/api
      uvicorn app.main:app --host 0.0.0.0 --port $PORT
    healthCheckPath: /api/health
    envVars:
      - key: PYTHON_VERSION
        value: "3.11.9"
      - key: WEB_ORIGIN
        value: "https://vibe-plotter-web.onrender.com"
      - key: LLM_MODEL
        value: "gpt-4o-mini"
      - key: OPENROUTER_BASE_URL
        value: "https://openrouter.ai/api/v1"
      - key: POSTHOG_ENABLED
        value: "true"
      - key: POSTHOG_HOST
        value: "https://us.i.posthog.com"
      - key: LLM_DISABLED
        value: "false"
      - key: MAX_CSV_BYTES
        value: "10000000"
      - key: OPENROUTER_API_KEY
        sync: false
      - key: OPENAI_API_KEY
        sync: false
      - key: POSTHOG_API_KEY
        sync: false
      - key: SESSION_SECRET
        sync: false
      - key: ALLOWED_CSV_HOSTS
        sync: false

  - type: web
    name: vibe-plotter-web
    runtime: node
    plan: starter
    buildCommand: |
      cd apps/web
      npm install
      npm run build
    startCommand: |
      cd apps/web
      npm run start -- --port $PORT
    envVars:
      - key: NEXT_PUBLIC_API_URL
        value: "https://vibe-plotter-api.onrender.com"
      - key: NEXT_PUBLIC_POSTHOG_ENABLED
        value: "true"
      - key: NEXT_PUBLIC_POSTHOG_HOST
        value: "https://us.i.posthog.com"
      - key: NEXT_PUBLIC_POSTHOG_KEY
        sync: false
